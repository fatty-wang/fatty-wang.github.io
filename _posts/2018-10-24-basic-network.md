---
layout: post
title: "网络基础"
date: 2018-10-24 
author: "WangX"
catalog: true
header-style: text
tags:
    - network
    - linux
    - basic
---
>update 2018-10-27

## OSI七层协议
>OSI: Open System Interconnection


!["OSI七层模型"](/img/network/OSI.png "OSI七层模型")
上图中的OSI七层协议：
1. 物理层：只能传输0和1这种比特信息，必须定义所使用的传输设备的信号，同时必须了解数据帧转成比特流的编码方式
2. 数据链路层：该层介于物理层和网络层之间，比较特殊。向下与物理层交互，偏硬，主要负责的是MAC(Media Access Control),这个数据包称为MAC数据帧，
MAC是网络接口设备所能处理的主要数据包裹，也是最终被物理层编码成比特流的数据。向上与网络层交互，偏软。主要指逻辑链接层(Logical Link Control,LLC)所控制，
主要在多任务处理来自上层的数据包数据(packer)并转换成MAC的格式，负责的工作包括信息交互，流量控制，失误问题的处理。
3. 网络层：IP(Internet Protocol)在这一层定义。同时也定义出计算机之间的连接建立，终止与维持等，数据包的传输路径选择等。最重要就是IP和路由(route)的概念。
4. 传输层：定义了发送端和接收端的连接技术(如 **TCP、UPD**技术)，同时包括该技术的数据包格式，数据包发送，流程的控制、传输过程的侦测检测与重新传送等，以确保
各个资料数据包可以正确无误的到达目的端。
5. 会话层：主要定义了两个地址之间的信道连接与中断，建立应用程序之间的会话，提供其他加强型服务：网络管理，建议与断开，会话控制等。以确保网络服务建立连接的确认。
6. 表示层：将来自本地应用程序的数据格式转换成为网络的标准格式，然后交给下面的传输层等的协议来进行处理。主要是数据格式的转换，包括数据的加解密也是在这个层次上处理。
7. 应用层：并不属于应用程序，定义应用程序如何进入该层的沟通接口，从而将数据接收或发送给应用程序，最终展示给用户。

>OSI七层模型是一个参考的理想模型，实际应用中则是以TCP/IP协议族的四层模型居多。

## TCP/IP四层协议
如下图所示：TCP/IP将应用、表示、会话三层整合成一个应用层，传输层没有变，且依据传送的可靠性又将数据报格式分为面向连接的TCP和无连接的UDP包格式。网络层没有变，主要是IP数据包和
路由功能。数据链路层和物理层则整合为一个网络接口层，包括定义硬件信号、数据帧转换为比特流的编码等，主要与硬件有关。
!["TCP/IP"](/img/network/TCP-IP.png "TCP/IP协议")

## TCP/IP的网络接口层的相关协议

#### 广域网

>传输距离较远，连接介质低廉，网络速度较慢且可靠性较低。

* 传统电话拨号连接，使用调制解调器，电话线及计算机的九针串行端口。通过 **PPP(Point-to-Point Protocol)** 协议，速度比较慢，拨号连接建立后就不能使用电话。PPP协议支持TCP/IP、NetBEUI、IPX/SPX等通信协议。
* 整合服务数字网络(Integerated Services Digital Network,ISDN)。电话线加两端调制解调器。ISDN的传输有多种信道可供使用，可以将多个信道整合应用，速度也成倍增长。
* 非对称数字用户环路(Asymmetric Digital Subscriber Line,ADSL)。电话线拨号获取IP，使用电话的高频部分，可以边上网边通话，由于上下行带宽不同，称为非对称环路。使用PPPoE，将PPP仿真在以太网卡上。
* 电缆调制解调器(Cable Modem)将有线电视的缆线作为网络信号介质。

#### 局域网(以太网为例)

>网络世界并非仅有以太网这个硬件接口

* 数据传输的单位为每秒多少bit,即bits/second(b/s)。而一般常用文件容量为bytes。1byte=8bit

以太网的传输协议：**CSMA/CD**

>CSMA/CD(Carrier Sense Multiple Access with Collision Detection) 载波监听多点接入/碰撞检测

以太网的传输主要就是网卡与网卡之间的数据传输。网卡在出厂时被赋予一个唯一的卡号，就是所谓的MAC(Media Access Control)地址。
网卡之间的数据传输通过IEEE 802.3的标准CSMA/CD技术。
* 集线器是一种网络共享介质设备，网络共享介质在单一时间点内，仅能被一台主机使用。

考虑一下场景：A B C D四台主机连接在一个集线器上。A的网卡要给D的网卡发送数据，则CSMA/CD的流程如下：
1. Carrier Sense: A网卡发送数据前，先对网络的使用情况进行监听，没有其他网卡使用后，才能够发送数据帧。
2. Multiple Access:A网卡发送的数据会被集线器复制一份，然后发送给所有连接此集线器的设备。A所发送的数据，B,C,D都能收到。但由于目标是D，B和C则会将此数据帧丢弃，而D则会处理。
3. Collision Detection: 该数据帧具有检测能力，若A和B刚好同时发送数据帧，造成Collision，则这两个数据帧被损毁，那么A与B就会各自随机等待一段时间，然后重新通过第一步再一次发送改数据帧。

* 标准的数据帧在网卡与其他以太网媒体一次只能传输 **1500bytes**，因为大文件会被拆分成多个小数据报，然后一个个传送，每个数据包发送前都要经过CSMA/CD机制。
* 超高速的以太网媒体若支持 **Jumbo frame(巨型数据帧)**，则可将数据帧的大小改为 **9000bytes**。

#### MAC的封装格式
>MAC帧是整个网络硬件上面传送的最小单位

!["MAC数据帧"](/img/network/mac_frame.png "MAC数据帧")

上图为MAC的帧结构：
1. 目的地址和源地址指的就是网卡卡号，MAC地址。6字节中前三个字节为厂商的代码，后面三个字节是该厂商自行定义的配置码。
2. MAC帧的传输如果跨过不同的子网，那么源地址的MAC地址会发生改变，因为变成了不通网卡之间的通讯了。只有在同一个子网内才能够直接进行MAC帧的收发。
3. 从LLC数据段可以看出数据容量最大可达1500bytes，最小的46bytes是由CSMA/CD机制算出来的，若要实现冲突检测，则数据帧总数据量最小需要有64bytes。再扣除目的地址，来源地址、校验码(前导序列不算)
就可得到数据量最小需要46bytes。若小于46bytes，系统会自动补上填充码，以补齐至少46bytes的容量。

* MTU(最大传输单位)。MAC帧的数据量最大可以为1500bytes,这个值被称为MTU。每种网络接口的MTU都不同，如有1492bytes的MTU。以太网的标准定义就是1500bytes。MTU的配置，要考虑MAC帧所经过的所有网络设备。

#### 集线器、交换器与相关机制

